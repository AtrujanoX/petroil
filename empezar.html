<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <link
    href="https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900|Open+Sans:400,300,600,700,800|Raleway:400,100,200,300,500,600,700,800,900"
    rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <link rel="stylesheet" href="assets/css/styleEmpezar.css" />
  <script>
    var pregunta = window.location.search.substring(4);
    var idPregunta = pregunta.toString();
  </script>
  <title>Encuesta Petroil</title>
</head>

<body onload="document.body.style.opacity='1'">
  <nav class="navbar navbar-light bg-light sombra sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="assets/img/logo.svg" alt="" width="150" />
      </a>
    </div>
  </nav>
  <form class="form" action="enviado.html">
    <div class="accordion" id="cuestionario">
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary" style="background: #1d3c66">
        Enviar
      </button>
    </div>
  </form>
  <script>
    //variable de sesion
    const data = { survey_id: [idPregunta] };
    //Envio de datos por metodo post
    fetch("https://crm.grupopetroil.com.mx:81/api/odoo/read_survey", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    })
      .then((response) => response.json())
      //Datos correctos
      .then((data) => {
        //console.log('Success:', data);
        //data.forEach(element => console.log(element));
        data.forEach((element) => {
          console.log(element.preguntas);
        });
        var infoPreguntas = "";
        var paginas;
        var objetos = [];
        var cuestionario = document.getElementById("cuestionario");
        data.forEach((encuesta) => {
          this.paginas = $.grep(encuesta.preguntas, function (n, i) {
            return n.is_page == true;
          });
          this.paginas.forEach((pagina) => {
            //<div class="accordion accordion-flush" id="accordionFlushExample">
            var pag =
              "<div class='accordion-item' id='page" + pagina.id_pregunta + "'>" +
              "<h2 class='accordion-header' id='head_page" + pagina.id_pregunta + "'>" +
              "<button class='accordion-button collapsed' type='button' data-bs-toggle='collapse' data-bs-target='#body_page" + pagina.id_pregunta + "' aria-expanded='true' aria-controls='body_page" + pagina.id_pregunta + "'>" +
              pagina.title +
              "</button>" +
              "</h2>" +
              "<div id='body_page" + pagina.id_pregunta + "' class='accordion-collapse collapse' aria-labelledby='head_page" + pagina.id_pregunta + "'>" +
              "<div class='accordion-body'>" +
              "</div>" +
              "</div>" +
              "</div>"
            document.getElementById("cuestionario").innerHTML += pag;
            objetos[pagina.id_pregunta] = pag;
          });
          encuesta.preguntas.forEach((pregunta) => {
            if (!pregunta.is_page) {
              var _pregunta = "<h4>" + pregunta.title + "</h4>";
              var req = pregunta.constr_mandatory ? 'required' : '';
              switch (pregunta.question_type) {
                case "simple_choice":
                  pregunta.valores.forEach(valor => {
                    _pregunta += "<div class='inputGroup'>" +
                      "<input " + req + " id='pregunta_" + pregunta.id_pregunta + "_" + valor.id + "' name='pregunta_" + pregunta.id_pregunta + "' type='radio' />" +
                      "<label for='pregunta_" + pregunta.id_pregunta + "_" + valor.id + "'>" + valor.value + "</label>" +
                      "</div>";
                  });
                  break;

                case "matrix":
                  var headers = $.grep(pregunta.valores, function (n, i) {
                    return n.header != null;
                  });
                  var values = $.grep(pregunta.valores, function (n, i) {
                    return n.value != null;
                  });
                  var req = pregunta.constr_mandatory ? 'required' : '';
                  console.log(pregunta);
                  _pregunta += "<table><tr><th></th>";
                  headers.forEach(header => {
                    _pregunta += "<th>" + header.header + "</th>";
                  });
                  _pregunta += "</tr>";
                  values.forEach(value => {
                    _pregunta += "<tr>";
                    _pregunta += "<td>" + value.value + "</td>";
                    headers.forEach(header => {
                      _pregunta += "<td><input " + req + " id='pregunta_" + pregunta.id_pregunta+"_"+ value.id + "_" + header.id + "' name='pregunta_" + pregunta.id_pregunta+"_"+ value.id + "' type='radio' /></td>";
                    });
                    _pregunta += "</tr>";
                  });
                  _pregunta += "</table>"
                  break;

                case "textbox": case "free_text":
                  _pregunta += "<input " + req + " id='pregunta_" + pregunta.id_pregunta + "' name='pregunta_" + pregunta.id_pregunta + "' type='text' placeholder='" + pregunta.title + "' />";
                  break;
                case "numerical_box":
                  _pregunta += "<input " + req + " id='pregunta_" + pregunta.id_pregunta + "' name='pregunta_" + pregunta.id_pregunta + "' type='number' />";
                  break;
              }

              if (pregunta.page_id != null) {
                document.getElementById("body_page" + pregunta.page_id).innerHTML += _pregunta;
              } else {
                document.getElementById("cuestionario").innerHTML += _pregunta;
              }
            }
          });
        });
        //document.getElementById("p1").innerHTML = infoPreguntas;
      })
      //Errores generados
      .catch((error) => {
        console.error("Error:", error);
      });
      //
  </script>
  <!-- Optional JavaScript; choose one of the two! -->
  <!-- Option 1: Bootstrap Bundle with Popper -->
  <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>-->
  <!-- Option 2: Separate Popper and Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js"
    integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT"
    crossorigin="anonymous"></script>
</body>

</html>